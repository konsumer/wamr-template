<html>
  <head>
    <title>null0</title>
    <link rel="icon" type="image/x-icon" href="https://avatars.githubusercontent.com/u/83857" />
  </head>
  <body>
  <p>Check console</p>
  </body>
  <script type="importmap">
    {
      "imports": {
        "easywasi": "https://esm.sh/easywasi",
        "@zenfs/core": "https://esm.sh/@zenfs/core",
        "@zenfs/dom": "https://esm.sh/@zenfs/dom",
        "@zenfs/zip": "https://esm.sh/@zenfs/zip"
      }
    }
  </script>
  <script type="module">
    import { fs } from '@zenfs/core'
    import setupWasm from './wasm.js'
    import setupHost from './null0.mjs'

    const imports = { null0: {} }
    const host = await setupHost({arguments: ["whatever"]})
    for (const f of  Object.keys(host)) {
      if (f !== '_main' && f[0] === '_') {
        imports.null0[f.substr(1)] = host[f]
      }
    }
    const cart = await setupWasm('main.wasm', { fs, imports, runStart: false })
    host.cart = cart

    const d = new TextDecoder()
    const e = new TextEncoder()

    if (cart.exports._start) {
      cart.exports._start()
    }
    if (cart.exports.load) {
      cart.exports.load()
    }
    if (cart.exports.update) {
      const u = () => {
        cart.exports.update(Date.now())
        requestAnimationFrame(u)
      }
      u()
    }
  </script>
</html>
